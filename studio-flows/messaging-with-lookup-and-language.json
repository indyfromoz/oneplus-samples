{
  "description": "Messaging with Lookup and Language",
  "states": [
    {
      "name": "Trigger",
      "type": "InitialState",
      "properties": {
        "offset": {
          "x": 0,
          "y": -10
        },
        "flow_url": "https://webhooks.twilio.com/v1/Accounts/AC5b097c7cc511678abc190a2120264bef/Flows/FW23dafdb45cd57841bb6281b3ff0b35f3"
      },
      "transitions": [
        {
          "event": "incomingMessage",
          "conditions": [],
          "next": "FF8c63b1041818d51a87ce40eb9d80ad2d",
          "uuid": "042ba699-e3fc-49b4-96db-45b51509e645"
        },
        {
          "event": "incomingCall",
          "conditions": [],
          "next": null,
          "uuid": "a02d2c46-345a-477a-935a-727b995c8a99"
        },
        {
          "event": "incomingRequest",
          "conditions": [],
          "next": null,
          "uuid": "56352140-3e03-4720-a3d8-dcd13ca7f172"
        }
      ],
      "sid": "FF65f9e2d8d879c287052329d0c74afc6b"
    },
    {
      "name": "SendToLevel1",
      "type": "SendToFlex",
      "properties": {
        "offset": {
          "x": 50,
          "y": 1560
        },
        "workflow": "WW30f9719bec2cc33896baad48009ea906",
        "channel": "TCe97abe107df7417d4d29c84a7b16afa5",
        "attributes": "{\"name\": \"{{trigger.message.ChannelAttributes.from}}\", \"channelType\": \"{{trigger.message.ChannelAttributes.channel_type}}\", \"channelSid\": \"{{trigger.message.ChannelSid}}\", \"toNumber\": \"{{trigger.message.ChannelAttributes.to}}\",\"country\":\"{{flow.variables.countryCode}}\",\"language\":\"{{flow.variables.language}}\"}",
        "timeout": null,
        "priority": null,
        "waitUrl": null,
        "waitUrlMethod": null
      },
      "transitions": [
        {
          "event": "callComplete",
          "conditions": [],
          "next": null,
          "uuid": "c6570c6c-bb7b-4c41-b64d-b51a730c36bd"
        },
        {
          "event": "failedToEnqueue",
          "conditions": [],
          "next": null,
          "uuid": "0917d882-c6c0-4b64-ba38-d718aa65eec5"
        },
        {
          "event": "callFailure",
          "conditions": [],
          "next": null,
          "uuid": "e44a5fff-148a-41b4-a3e8-4e0208846894"
        }
      ],
      "sid": "FF2b2a73aab7e35601ecc23fd78d7a6fb1"
    },
    {
      "name": "SetCountryCode",
      "type": "SetVariables",
      "properties": {
        "offset": {
          "x": 30,
          "y": 440
        },
        "variables": [
          {
            "key": "countryCode",
            "value": "{{widgets.FunctionLookupPhoneNumber.parsed.countryCode}}",
            "index": "0"
          }
        ]
      },
      "transitions": [
        {
          "event": "next",
          "conditions": [],
          "next": "FF95bf9bf5340b35dc27b4be908f824856",
          "uuid": "b12018b4-2ed5-4b05-8724-b4ea8c87a68b"
        }
      ],
      "sid": "FF34bebeee44efac1b1414e0c1df239cec"
    },
    {
      "name": "FunctionLookupPhoneNumber",
      "type": "Function",
      "properties": {
        "offset": {
          "x": 30,
          "y": 210
        },
        "url": "https://folly-rail-4787.twil.io/lookup-source-number",
        "timeout": null,
        "parameters": [
          {
            "key": "phoneNumber",
            "value": "{{trigger.message.ChannelAttributes.from}}"
          }
        ]
      },
      "transitions": [
        {
          "event": "success",
          "conditions": [],
          "next": "FF34bebeee44efac1b1414e0c1df239cec",
          "uuid": "9a0d7801-9c14-4b58-ac25-5b1982026377"
        },
        {
          "event": "fail",
          "conditions": [],
          "next": null,
          "uuid": "daede5c4-3552-4b97-97ae-78e3d905d8f5"
        }
      ],
      "sid": "FF8c63b1041818d51a87ce40eb9d80ad2d"
    },
    {
      "name": "FunctionGetLanguage",
      "type": "Function",
      "properties": {
        "offset": {
          "x": 40,
          "y": 650
        },
        "url": "https://folly-rail-4787.twil.io/get-language-by-country-code",
        "timeout": null,
        "parameters": [
          {
            "key": "countryCode",
            "value": "{{flow.variables.countryCode}}"
          }
        ]
      },
      "transitions": [
        {
          "event": "success",
          "conditions": [],
          "next": "FFcb474bf2be8c7f9f0868db95fabb604b",
          "uuid": "881410af-0321-4dd1-a959-73152bd57bd4"
        },
        {
          "event": "fail",
          "conditions": [],
          "next": null,
          "uuid": "91afecb3-728e-44f2-b619-71a4ccce9112"
        }
      ],
      "sid": "FF95bf9bf5340b35dc27b4be908f824856"
    },
    {
      "name": "SetLanguage",
      "type": "SetVariables",
      "properties": {
        "offset": {
          "x": 40,
          "y": 870
        },
        "variables": [
          {
            "key": "language",
            "value": "{{widgets.FunctionGetLanguage.parsed.language}}",
            "index": "0"
          }
        ]
      },
      "transitions": [
        {
          "event": "next",
          "conditions": [],
          "next": "FF1e739bf37ae87dbf94f561b9ac757f90",
          "uuid": "5d66d953-786a-4204-a3d9-be19d879224a"
        }
      ],
      "sid": "FFcb474bf2be8c7f9f0868db95fabb604b"
    },
    {
      "name": "FunctionGetGreeting",
      "type": "Function",
      "properties": {
        "offset": {
          "x": 50,
          "y": 1100
        },
        "url": "https://folly-rail-4787.twil.io/get-message-greeting",
        "timeout": null,
        "parameters": [
          {
            "key": "language",
            "value": "{{flow.variables.language}}"
          }
        ]
      },
      "transitions": [
        {
          "event": "success",
          "conditions": [],
          "next": "FF60cc03d7fed07c69a7e6a6dffae640a9",
          "uuid": "b0e6aa4e-8ede-47a9-ac41-2ec91d6d0466"
        },
        {
          "event": "fail",
          "conditions": [],
          "next": null,
          "uuid": "7f2fe6b7-6be1-4991-a21b-46308c098cfd"
        }
      ],
      "sid": "FF1e739bf37ae87dbf94f561b9ac757f90"
    },
    {
      "name": "SendGreeting",
      "type": "Message",
      "properties": {
        "offset": {
          "x": 50,
          "y": 1320
        },
        "body": "{{widgets.FunctionGetGreeting.parsed.message}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "media_url": null,
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "attributes": null
      },
      "transitions": [
        {
          "event": "sent",
          "conditions": [],
          "next": "FF2b2a73aab7e35601ecc23fd78d7a6fb1",
          "uuid": "e35f1593-52d4-47dd-8626-c42b3272583b"
        },
        {
          "event": "failed",
          "conditions": [],
          "next": null,
          "uuid": "3e4ee960-8131-4bd7-9734-16d70f9b13c6"
        }
      ],
      "sid": "FF60cc03d7fed07c69a7e6a6dffae640a9"
    }
  ]
}